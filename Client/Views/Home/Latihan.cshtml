@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<style>
    .showImage {
        
        text-align: center;
        justify-content: center;
        align-items: center;
    }
    .showImage>img{
        width:150px;
        height:auto;
        
    }

    .ShowChartWrapper {
        display:none
    }

    .capitalCase {
        text-transform: capitalize;
    }

    .hwPoke div{
        display:flex;
        margin-left:15px;
        width:30%;
        position:relative;
       
        

    }
    .hwPoke img{
        width:40px;
        height:40px;
        
        
    }
    .hwPoke{
        display:flex;

    }
    .weightPoke, .heightPoke{
        display:flex;
        justify-content:center;
        flex-direction:column;
        font-size:20px;
        
    }
    .loading { 
        width: 100%; 
        height: 100%; 
        
        z-index: 100; 
        
        background-color: white;
        position: absolute; 
        left: 0; 
        top: 0; 
        display: flex; 
    
    }
    .loading>div{
        width:200px;
        height:200px;
        margin:auto;
        
    }

    .modal-body{
        
    }

    .iconImage{
        width:80px;
        height:80px;
    }

    .specTitle {
        font-size: 20px;
        color: rgba(0,88,113,1);
        padding:0;
    }
    .iconImageWrapper{
        position:relative;
        padding-top:-200px;
       
    }
    .iconImage {
        background-color: rgba(0,88,113,0.5);
        margin: 2px;
    }
    label{
        color:white;
    }
    .abilityWrapper{
        
    }
    .comparewrapper{
        display:inline-block;
        width:100%;
     
        justify-content:center;
        text-align:center;
    }
    
</style>

<div class="" style="margin-top:150px;">
    <table class="table table-striped" id="poketable" style="margin-top:20px">
        <thead>
        <th class="text-light">No</th>
        <th class="text-light">Name</th>
        <th class="text-light"> URL</th>
        <th class="text-light">Action</th>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle ">Detail</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="resetchart()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body " >
                <div class="loading">
                    <div>
                        @{
                            Html.RenderPartial("~/Views/Home/LoadingSceene.cshtml");
                        }
                    </div>
                </div>
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item showImage active">
                            <img class="showPokeBack" src="" />
                        </div>

                        <div class="carousel-item showImage">
                            <img class="showPokeDefault" src="" />
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                    <div style="justify-content:center;text-align:center;">
                        <h2 class="namePoke capitalCase">
                            Ipsum.
                        </h2>
                        <p class="categoryPoke">
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                       
                        <div class="hwPokeParent  ">
                            <h4 class="specTitle">Weight & Height</h4>
                           
                                    <span class="badge badge-primary pokeWeight">W-100</span>
                                
                                    <span class="badge badge-primary pokeHeight">H-100</span>
                              
                            
                        </div>
                        <div class="mt-2">
                            <h4 class="specTitle">Ability</h4>
                            <div class="abilityWrapper">
                                <button type="button" class="btn btn-primary abi1" data-toggle="collapse" data-target="#demo">Simple collapsible</button>
                                <div id="demo" class="collapse abidetail1">
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                                    sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                                    quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                </div>
                                <button type="button" class="btn btn-secondary abi2" data-toggle="collapse" data-target="#demo2">Simple collapsible</button>
                                <div id="demo2" class="collapse abidetail2">
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                                    sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                                    quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                </div>
                            </div>
                        </div>

                        <div class="icons Parent mt-2">
                            <h4 class="specTitle">Icons</h4>
                            <div class="iconImageWrapper">
                                <img class="iconImage back-default" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/back/1.png" alt="" />
                                <img class="iconImage back-shiny" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/back/1.png" alt="" />
                                <img class="iconImage front-default" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/back/1.png" alt="" />
                                <img class="iconImage front-shiny" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/back/1.png" alt="" />
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="row chart">
                            <div class="ShowChartWrapper" >
                            </div>
                            <div class="comparewrapper" >
                                <div class="dropdown show">
                                    <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Compare Pokemon
                                    </a>

                                    <div class="dropdown-menu listCompare" aria-labelledby="dropdownMenuLink">
                                        <a class="dropdown-item" href="#">Action</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                       
                    </div>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="resetchart()" >Close</button>
                
            </div>
        </div>
    </div>
</div>


<script src="~/js/chartCharacter.js">
</script>
<script>
    
    let loadingSceene = document.querySelector(".loading");
    let radar = null;
    
    function resetchart() {
        document.querySelector(".ShowChartWrapper").innerHTML = ``
        loadingSceene.style.display = "flex";
    }
    $.ajax({
        url: "https://pokeapi.co/api/v2/pokemon/"
    }).done(res => {
        let i = 1
        res.results.forEach(e => {
            $("tbody").append(`
                    <tr scope="row ">
                        <td class="text-light">${i++}</td>
                        <td class="text-light capitalCase">${e.name}</td>
                        <td class="text-light">${e.url}</td>
                        <td class="text-light">
                                <button type="button" onClick="fetchPokemon(' https://pokeapi.co/api/v2/pokemon/${e.name}')" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
                                      Detail
                                </button>

                        </td>
                    </tr>
                `)
            $(".listCompare").append(`<a class="dropdown-item" onclick=addtoChart('https://pokeapi.co/api/v2/pokemon/${e.name}') href="#">${e.name}</a>`)
        })
    }).fail(err => console.log(err))

    function fetchPokemon(url) {
        
        document.querySelector(".ShowChartWrapper").innerHTML = `<canvas width="400px" height="400px" id="showChart"></canvas>`
        loadingSceene.style.display = "flex";
        $.ajax({
            url
        }).done(e => {
            setTimeout(() => {
                loadingSceene.style.display = "none";
            }, 2000)
            console.log(e)

            

            $(".showPokeBack").attr("src", e.sprites.other.home.front_default)
            $(".showPokeDefault").attr("src", e.sprites.other.home.front_shiny)


            //weight height
            $(".pokeWeight").text(`W-${e.weight}`)
            $(".pokeHeight").text(`H-${e.height}`)

            //abi1
            $(".abi1").html(`
                <span class="badge ">${e.abilities[0].ability.name}</span>
            `)
            $.ajax({
                url: e.abilities[0].ability.url
            }).done(e => {
                let abi = e.effect_entries.filter(e => e.language.name === "en")
                console.log(abi)
                $(".abidetail1").text(abi[0].effect)
            })

            //abi2
            $(".abi2").html(`
                <span class="badge ">${e.abilities[1].ability.name}</span>
            `)
            $.ajax({
                url: e.abilities[1].ability.url
            }).done(e => {
                let abi = e.effect_entries.filter(e => e.language.name === "en")
                $(".abidetail2").text(abi[0].effect)
            })

            $(".back-default").attr("src", e.sprites.back_default)
            $(".back-shiny").attr("src", e.sprites.back_shiny)
            $(".front-default").attr("src", e.sprites.front_default)
            $(".front-shiny").attr("src", e.sprites.front_shiny)

            $(".namePoke").text(e.name)
            let name = ""
            e.types.forEach(e => {
                name += `<span class="badge badge-primary">${e.type.name}</span> &nbsp;`
                $(".categoryPoke").html(name)
            })
           
            radar =  showChart(e)
            
            
            

          
            //sprite
        })
    }
    function addtoChart(url) {

        $.ajax({
            url
        }).done(e => {

            radar.data.datasets.push(
                {
                    label: e.name,
                    backgroundColor: RandomArray(),
                    pointBackgroundColor: 'rgba(0,88,113,0.5)',
                    pointBorderColor: 'rgba(0,88,113,0.5)',
                    data: [
                        e.stats[0].base_stat,
                        e.stats[1].base_stat,
                        e.stats[2].base_stat,
                        e.stats[3].base_stat,
                        e.stats[4].base_stat,
                        e.stats[5].base_stat,
                    ]
                })

            radar.update();
        })

       
    }

    function RandomArray() {
        let arr = [
            "rgba(255, 55, 145, 0.27)",
            "rgba(19, 179, 63, 0.27)",
            "rgba(22, 24, 15, 0.27)",
            "rgba(180, 130, 15, 0.62)",
            "rgba(24, 175, 255, 0.8)",
            "rgba(24, 20, 255, 0.57)",
            "rgba(195, 20, 255, 0.57)",
            "rgba(195, 101, 0, 0.57)",
            "rgba(195, 236, 0, 0.57)"
        ]

        return arr[Math.floor(Math.random() * arr.length)];
    }

    
    $(document).ready(function () {
        $('#poketable').DataTable();
    });


</script>